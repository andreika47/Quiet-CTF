# Tachmasib
**MCTF 2025**

Изучим формулу получения сессионных ключей:
$$K_1 = (g^{x_{2.1}} * P_2^{-1})^{R_{1.1}} = (g^{R{2.1} + s_2} * (g^{s_2})^{-1})^{R_{1.1}} = (g^{R_{2.1} + s_2 - s_2})^{R_{1.1}} = g^{R_{2.1}R_{1.1}}$$
$$K_2 = (g^{x_{2.2}} * P_2^{-1})^{R_{1.1}} = (g^{R{2.2} + s_2} * (g^{s_2})^{-1})^{R_{1.1}} = (g^{R_{2.2} + s_2 - s_2})^{R_{1.1}} = g^{R_{2.2}R_{1.1}}$$

$K_1$, $K_2$ - первый и второй сессионные ключи, $X_{2.1} = R_{2.1} + s_2$, $X_{2.2} = R_{2.2} + s_2$ - одноразовые публичные данные для генерации первого и второго сессионных ключей, $R_{1.1}$, $R_{1.2}$ - одноразовые секретные данные первого члена экипажа для генерации первого и второго сессионных ключей, $R_{2.1}$, $R_{2.2}$ - одноразовые секретные данные второго члена экипажа для генерации первого и второго сессионных ключей, $s_1$, $s_2$ - постоянные секретные ключи первого и второго членов экипажа. 
Как мы видим, что сессионные ключи зависят только от одноразовых секретных данных, которые выбрал каждый из членов экипажа. Попробуем их вычислить через известные нам данные:
$$g^{R_{2.1}R_{1.1}} = g^{(X_{2.1} - s_2)(X_{1.1} - s_1)} = g^{X_{2.1}X_{1.1} - s_1X_{2.1} - s_2X_{1.1} + s_1s_2} = g^{X_{2.1}X_{1.1}} * g^{-s_1X_{2.1}} * g^{-s_2X_{1.1}} * g^{s_1s_2} = g^{X_{2.1}X_{1.1}} * (g^{s_1})^{-X_{2.1}} * (g^{s_2})^{-X_{1.1}} * g^{s_1s_2} = g^{X_{2.1}X_{1.1}} * P_1^{-X_{2.1}} * P_2^{-X_{1.1}} * g^{s_1s_2}$$

Заметим, что при выражении $R$ через $X$ и $s$ в формуле появилась часть, которая не привязана к конкретному сессионному ключу, и будет общей для всех ключей: $g^{s_1s_2}$. Попробуем выразить ее через известные нам данные:
$$g^{s_1s_2} = g^{R_{2.1}R_{1.1}} * (g^{X_{2.1}X_{1.1} * P_1^{-X_{2.1}} * P_2^{-X_{1.1}})^{-1} = K_1 * (g^{X_{2.1}X_{1.1} * P_1^{-X_{2.1}} * P_2^{-X_{1.1}})^{-1}$$

Далее, подставим формулу для общей части в формулу генерации второго сессионного ключа:
$$K_2 = g^{R_{2.2}R_{1.2}} = g^{(X_{2.2} - s_2)(X_{1.2} - s_1)} = g^{X_{2.2}X_{1.2} - s_1X_{2.2} - s_2X_{1.2} + s_1s_2} = g^{X_{2.2}X_{1.2}} * g^{-s_1X_{2.2}} * g^{-s_2X_{1.2}} * g^{s_1s_2} = g^{X_{2.2}X_{1.2}} * P_1^{-X_{2.2}} * P_2^{-X_{1.2}} * g^{s_1s_2} = g^{X_{2.2}X_{1.2}} * P_1^{-X_{2.2}} * P_2^{-X_{1.2}} * K_1 * (g^{X_{2.1}X_{1.1} * P_1^{-X_{2.1}} * P_2^{-X_{1.1}})^{-1}$$

Получаем, что мы можем выразить второй сессионный ключ через имеющиеся у нас данные. Остается только написать скрипт, который вычислит $K_2$  и расшифрует файл с траекторией. Пример кода с решение [solve.py](https://github.com/andreika47/Quiet-CTF/blob/main/Tachmasib/solve.py)

#crypto #DH
